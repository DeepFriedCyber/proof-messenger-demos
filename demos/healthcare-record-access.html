<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSecure Hospital - Privacy-Proof Record Access</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .demo-header {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3c72 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .doctor-panel, .patient-panel {
            min-height: 600px;
            border: 2px solid #dee2e6;
            border-radius: 0.5rem;
            padding: 1.5rem;
        }
        .doctor-panel {
            background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
            border-color: #007bff;
        }
        .patient-panel {
            background: linear-gradient(to bottom, #fff3cd 0%, #ffffff 100%);
            border-color: #ffc107;
        }
        .record-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 1rem 0;
        }
        .compliance-log {
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 0.375rem;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.875rem;
        }
        .consent-modal .modal-content {
            border: 3px solid #28a745;
        }
        .biometric-scanner {
            width: 100px;
            height: 100px;
            border: 3px solid #28a745;
            border-radius: 50%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle, #28a745 0%, #20c997 100%);
            color: white;
            font-size: 2rem;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        .encrypted-content {
            filter: blur(5px);
            transition: filter 0.5s ease;
        }
        .decrypted-content {
            filter: none;
        }
        .hipaa-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-hospital"></i> MedSecure Hospital</h1>
                    <p class="lead mb-0">Privacy-Proof Medical Record Access System</p>
                    <small>HIPAA-Compliant • Patient-Controlled • Zero-Trust Architecture</small>
                </div>
                <div class="col-md-4 text-end">
                    <div class="badge bg-success fs-6">
                        <i class="fas fa-user-shield"></i> Patient Consent Required
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Doctor's View -->
            <div class="col-md-6">
                <div class="doctor-panel">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-user-md text-primary fs-3 me-3"></i>
                        <div>
                            <h4 class="mb-0">Doctor's View</h4>
                            <small class="text-muted">Dr. Sarah Mitchell, Orthopedic Surgeon</small>
                        </div>
                    </div>

                    <!-- Patient Selection -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6><i class="fas fa-search"></i> Patient Lookup</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="patientSelect" class="form-label">Select Patient</label>
                                <select class="form-select" id="patientSelect">
                                    <option value="">Choose a patient...</option>
                                    <option value="patient-001">John Smith (DOB: 1985-03-15)</option>
                                    <option value="patient-002">Maria Garcia (DOB: 1992-07-22)</option>
                                    <option value="patient-003">Robert Johnson (DOB: 1978-11-08)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Record Request -->
                    <div class="card mb-3" id="requestPanel" style="display: none;">
                        <div class="card-header">
                            <h6><i class="fas fa-file-medical"></i> Record Access Request</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="recordType" class="form-label">Record Requested</label>
                                <select class="form-select" id="recordType">
                                    <option value="mri-2025-07-12">MRI Scan Results - July 12, 2025</option>
                                    <option value="xray-2025-06-28">X-Ray Images - June 28, 2025</option>
                                    <option value="bloodwork-2025-07-01">Blood Work Panel - July 1, 2025</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="accessReason" class="form-label">Medical Justification</label>
                                <textarea class="form-control" id="accessReason" rows="3" placeholder="Enter medical reason for accessing this record...">Follow-up consultation for post-operative recovery assessment. Patient reported continued discomfort in surgical area.</textarea>
                            </div>
                            <button class="btn btn-primary" id="requestAccessBtn">
                                <i class="fas fa-paper-plane"></i> Request Access
                            </button>
                        </div>
                    </div>

                    <!-- Access Status -->
                    <div class="card mb-3" id="statusPanel" style="display: none;">
                        <div class="card-header">
                            <h6><i class="fas fa-hourglass-half"></i> Access Status</h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning" id="statusAlert">
                                <i class="fas fa-clock"></i> <strong>Awaiting Patient Consent</strong><br>
                                Request sent to patient for authorization.
                            </div>
                            <button class="btn btn-success" id="verifyUnlockBtn" disabled>
                                <i class="fas fa-unlock"></i> Verify & Unlock Record
                            </button>
                        </div>
                    </div>

                    <!-- Unlocked Record -->
                    <div class="card" id="recordPanel" style="display: none;">
                        <div class="card-header position-relative">
                            <h6><i class="fas fa-file-medical-alt"></i> Medical Record</h6>
                            <div class="hipaa-badge">HIPAA PROTECTED</div>
                        </div>
                        <div class="card-body">
                            <div id="medicalRecord" class="encrypted-content">
                                <h6>MRI Scan Results - July 12, 2025</h6>
                                <div class="record-preview">
                                    <p><strong>Patient:</strong> John Smith</p>
                                    <p><strong>Procedure:</strong> Lumbar Spine MRI with Contrast</p>
                                    <p><strong>Findings:</strong> Post-surgical changes consistent with L4-L5 discectomy. Minimal residual disc material. No evidence of recurrent herniation.</p>
                                    <p><strong>Impression:</strong> Successful surgical outcome. Recommend continued physical therapy.</p>
                                    <div class="mt-3">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk1SSSBJbWFnZSBQbGFjZWhvbGRlcjwvdGV4dD48L3N2Zz4=" alt="MRI Scan" class="img-fluid">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patient's View -->
            <div class="col-md-6">
                <div class="patient-panel">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-user text-warning fs-3 me-3"></i>
                        <div>
                            <h4 class="mb-0">Patient's View</h4>
                            <small class="text-muted">John Smith - Patient Portal</small>
                        </div>
                    </div>

                    <!-- Consent Request -->
                    <div class="card mb-3" id="consentPanel" style="display: none;">
                        <div class="card-header">
                            <h6><i class="fas fa-shield-alt"></i> Record Access Request</h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> <strong>Access Request Received</strong><br>
                                A healthcare provider is requesting access to your medical records.
                            </div>
                            
                            <div class="mb-3">
                                <strong>Requesting Doctor:</strong><br>
                                <span class="text-muted">Dr. Sarah Mitchell, Orthopedic Surgeon</span>
                            </div>
                            
                            <div class="mb-3">
                                <strong>Record Requested:</strong><br>
                                <span class="text-muted" id="requestedRecord">MRI Scan Results - July 12, 2025</span>
                            </div>
                            
                            <div class="mb-3">
                                <strong>Medical Justification:</strong><br>
                                <div class="bg-light p-2 rounded">
                                    <small id="medicalJustification">Follow-up consultation for post-operative recovery assessment. Patient reported continued discomfort in surgical area.</small>
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <button class="btn btn-success" id="approveConsentBtn">
                                    <i class="fas fa-check"></i> Approve & Sign Consent
                                </button>
                                <button class="btn btn-outline-danger">
                                    <i class="fas fa-times"></i> Deny Access
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Consent Granted -->
                    <div class="card mb-3" id="consentGrantedPanel" style="display: none;">
                        <div class="card-header">
                            <h6><i class="fas fa-check-circle text-success"></i> Consent Granted</h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-success">
                                <i class="fas fa-shield-check"></i> <strong>Access Authorized</strong><br>
                                Dr. Sarah Mitchell can now access your MRI scan results.
                            </div>
                            <div class="mb-2">
                                <strong>Consent Valid Until:</strong><br>
                                <small class="text-muted">24 hours from authorization</small>
                            </div>
                            <div class="mb-2">
                                <strong>Access Scope:</strong><br>
                                <small class="text-muted">MRI Scan Results - July 12, 2025 only</small>
                            </div>
                        </div>
                    </div>

                    <!-- Patient Rights Info -->
                    <div class="card">
                        <div class="card-header">
                            <h6><i class="fas fa-info-circle"></i> Your Privacy Rights</h6>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled mb-0">
                                <li><i class="fas fa-check text-success me-2"></i> You control who accesses your records</li>
                                <li><i class="fas fa-check text-success me-2"></i> All access is logged and auditable</li>
                                <li><i class="fas fa-check text-success me-2"></i> Consent can be revoked at any time</li>
                                <li><i class="fas fa-check text-success me-2"></i> Records remain encrypted until you approve</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compliance Logging Area -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-clipboard-list"></i> HIPAA Compliance Audit Trail</h5>
                        <small class="text-muted">Real-time logging for regulatory compliance</small>
                    </div>
                    <div class="card-body">
                        <div id="complianceLog" class="compliance-log">
                            <div>HIPAA Audit System v3.1 - Active</div>
                            <div>All medical record access will be logged here...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Biometric Consent Modal -->
    <div class="modal fade" id="biometricModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content consent-modal">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-fingerprint"></i> Biometric Consent Verification</h5>
                </div>
                <div class="modal-body text-center">
                    <p>Please provide biometric confirmation to authorize record access.</p>
                    <div class="biometric-scanner mb-3" id="biometricScanner">
                        <i class="fas fa-fingerprint"></i>
                    </div>
                    <p class="text-muted">Touch the scanner above to confirm your identity</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        // Demo state
        let demoState = {
            currentRequest: null,
            patientConsent: false,
            recordUnlocked: false
        };

        // Compliance logging
        function logCompliance(event, details) {
            const log = document.getElementById('complianceLog');
            const timestamp = new Date().toISOString();
            const entry = {
                timestamp,
                event,
                details,
                user_id: details.user_id || 'unknown',
                patient_id: 'patient-001',
                record_id: details.record_id || 'mri-2025-07-12'
            };
            
            log.innerHTML += `\n[${timestamp}] ${event}`;
            log.innerHTML += `\n${JSON.stringify(entry, null, 2)}`;
            log.scrollTop = log.scrollHeight;
        }

        // Patient selection handler
        document.getElementById('patientSelect').addEventListener('change', function() {
            if (this.value) {
                document.getElementById('requestPanel').style.display = 'block';
                logCompliance('PATIENT_SELECTED', {
                    user_id: 'dr.mitchell@medsecure.com',
                    patient_id: this.value,
                    action: 'patient_lookup'
                });
            }
        });

        // Request access handler
        document.getElementById('requestAccessBtn').addEventListener('click', function() {
            const recordType = document.getElementById('recordType').value;
            const reason = document.getElementById('accessReason').value;
            
            demoState.currentRequest = {
                doctor: 'Dr. Sarah Mitchell',
                record: recordType,
                reason: reason,
                timestamp: new Date().toISOString()
            };

            // Update UI
            document.getElementById('requestPanel').style.display = 'none';
            document.getElementById('statusPanel').style.display = 'block';
            document.getElementById('consentPanel').style.display = 'block';
            document.getElementById('requestedRecord').textContent = 'MRI Scan Results - July 12, 2025';
            document.getElementById('medicalJustification').textContent = reason;

            logCompliance('ACCESS_REQUEST_SENT', {
                user_id: 'dr.mitchell@medsecure.com',
                record_id: recordType,
                justification: reason,
                patient_notified: true
            });
        });

        // Approve consent handler
        document.getElementById('approveConsentBtn').addEventListener('click', function() {
            // Show biometric modal
            const modal = new bootstrap.Modal(document.getElementById('biometricModal'));
            modal.show();

            // Simulate biometric scan
            document.getElementById('biometricScanner').addEventListener('click', function() {
                // Simulate scanning delay
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-check"></i>';
                    this.style.background = 'radial-gradient(circle, #28a745 0%, #20c997 100%)';
                    
                    setTimeout(() => {
                        modal.hide();
                        processConsent();
                    }, 1000);
                }, 2000);
            }, { once: true });
        });

        function processConsent() {
            demoState.patientConsent = true;
            
            // Update patient view
            document.getElementById('consentPanel').style.display = 'none';
            document.getElementById('consentGrantedPanel').style.display = 'block';
            
            // Update doctor view
            document.getElementById('statusAlert').className = 'alert alert-success';
            document.getElementById('statusAlert').innerHTML = '<i class="fas fa-check-circle"></i> <strong>Patient Consent Granted</strong><br>You may now access the requested record.';
            document.getElementById('verifyUnlockBtn').disabled = false;

            logCompliance('PATIENT_CONSENT_GRANTED', {
                user_id: 'patient.john.smith@email.com',
                consent_method: 'biometric_fingerprint',
                doctor_authorized: 'dr.mitchell@medsecure.com',
                consent_scope: 'mri-2025-07-12',
                consent_duration: '24_hours'
            });
        }

        // Verify and unlock record
        document.getElementById('verifyUnlockBtn').addEventListener('click', function() {
            if (!demoState.patientConsent) return;

            // Simulate verification process
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
            this.disabled = true;

            setTimeout(() => {
                // Show unlocked record
                document.getElementById('statusPanel').style.display = 'none';
                document.getElementById('recordPanel').style.display = 'block';
                
                // Decrypt animation
                setTimeout(() => {
                    document.getElementById('medicalRecord').classList.remove('encrypted-content');
                    document.getElementById('medicalRecord').classList.add('decrypted-content');
                }, 500);

                demoState.recordUnlocked = true;

                logCompliance('RECORD_ACCESS_GRANTED', {
                    user_id: 'dr.mitchell@medsecure.com',
                    record_id: 'mri-2025-07-12',
                    patient_consent_verified: true,
                    access_method: 'proof_messenger_protocol',
                    encryption_status: 'decrypted_for_authorized_user'
                });

                logCompliance('HIPAA_AUDIT_COMPLETE', {
                    audit_trail_id: 'audit_' + Date.now(),
                    all_requirements_met: true,
                    patient_consent: 'verified',
                    doctor_authorization: 'verified',
                    access_scope: 'limited_to_requested_record',
                    compliance_status: 'COMPLIANT'
                });

            }, 3000);
        });

        // Initialize demo
        logCompliance('SYSTEM_INITIALIZED', {
            user_id: 'system',
            hipaa_compliance_active: true,
            proof_messenger_protocol: 'v2.0',
            encryption_standard: 'AES-256-GCM'
        });
    </script>
</body>
</html>